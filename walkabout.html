<html>
<head>
    <title>Walkabout</title>
    <style>
      canvas { 
        width: 100%; 
        height: 100% 
      }
      body {
        margin: 0;
      }
    </style>
</head>
<body>

<div id="render" class="render"></div>
<div id="labels" class="labels"></div>
<div id="instructions">
        <span style="font-size:40px">Click to play</span>
        <br />
        (W, A, S, D = Move, SPACE = Jump, MOUSE = Look around)
</div>


<!--
  Vendor specific includes go first.
-->
<script type="text/javascript" src="js/vendor/dat.gui.min.js"></script>
<script type="text/javascript" src="js/vendor/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/vendor/threexresize.js"></script>
<script type="text/javascript" src="js/vendor/threex.objcoord.js"></script>
<script type="text/javascript" src="js/vendor/two.min.js"></script>
<script type="text/javascript" src="js/vendor/Three.js"></script>
<script type="text/javascript" src="js/vendor/stats.js"></script>
<script type="text/javascript" src="js/vendor/PointerLockControls.js"></script>

<script type="text/javascript">
  $(function(){

    var instructions = document.getElementById( 'instructions' );
    var controls;
      // http://www.html5rocks.com/en/tutorials/pointerlock/intro/

    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

    if ( havePointerLock ) {
      var element = document.body;
      var pointerlockchange = function ( event ) {
        if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {
          controls.enabled = true;

          blocker.style.display = 'none';

        } else {
          controls.enabled = false;

          blocker.style.display = '-webkit-box';
          blocker.style.display = '-moz-box';
          blocker.style.display = 'box';

          instructions.style.display = '';
        }
      }
      var pointerlockerror = function ( event ) {
        instructions.style.display = '';
      }

      // Hook pointer lock state change events
      document.addEventListener( 'pointerlockchange', pointerlockchange, false );
      document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
      document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );

      document.addEventListener( 'pointerlockerror', pointerlockerror, false );
      document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );
      document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );

      instructions.addEventListener( 'click', function ( event ) {
        instructions.style.display = 'none';

        // Ask the browser to lock the pointer
        element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

        if ( /Firefox/i.test( navigator.userAgent ) ) {
          var fullscreenchange = function ( event ) {
            if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {
              document.removeEventListener( 'fullscreenchange', fullscreenchange );
              document.removeEventListener( 'mozfullscreenchange', fullscreenchange );
              element.requestPointerLock();
            }
          }
          document.addEventListener( 'fullscreenchange', fullscreenchange, false );
          document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );
          element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;
          element.requestFullscreen();
        } else {
          element.requestPointerLock();
        }
      }, false );
    } else {
      instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';
    }

    var scene = new THREE.Scene();
    scene.fog = new THREE.Fog( 0xffffff, 0, 750 );
    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 5000 );

    var renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.setClearColor( 0xffffff );
    document.body.appendChild( renderer.domElement );

    camera.lookAt( new THREE.Vector3(0,0,0) );

    controls = new THREE.PointerLockControls( camera );
    scene.add( controls.getObject() );

    var hemiLight = new THREE.HemisphereLight( 0xffffff, 0x404040, 0.9 );
    hemiLight.color.setHSL( 0.55, 1, 1.0 );
    hemiLight.groundColor.setHSL( 0.095, 1, 0.5 );
    hemiLight.position.set( 0, 500, 0 );

    var pLight = new THREE.PointLight( 0xffffff, .5, 10000 );
    pLight.position.set( 500, 500, 500 );
    scene.add( pLight );
    scene.add( hemiLight );

    var geometry = new THREE.CubeGeometry(10,10,10);
    var material = new THREE.MeshPhongMaterial( { color: 0x00ff00 } );
    var cube = new THREE.Mesh( geometry, material );

    var size = 1000;
    var step = 10;
    var gridHelper = new THREE.GridHelper( size, step );

    gridHelper.position = new THREE.Vector3( 0, 0, 0 );

    scene.add( gridHelper );
    scene.add( cube );

    function render() {
      requestAnimationFrame(render);
      controls.update();
      renderer.render(scene, camera);
    }
    render();

  });
</script>

</body>
</html>